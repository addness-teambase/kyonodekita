# ğŸ”§ ãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½ãƒ‡ãƒãƒƒã‚°ã‚¬ã‚¤ãƒ‰

## ğŸš¨ ãƒãƒ£ãƒƒãƒˆãŒã§ããªã„å•é¡Œã®ç¢ºèªæ‰‹é †

### **1. ç®¡ç†è€…å´ãƒã‚§ãƒƒã‚¯**

#### **Step 1: ç®¡ç†è€…ãƒ­ã‚°ã‚¤ãƒ³ç¢ºèª**
1. **ç®¡ç†è€…å´** (`http://localhost:5174`) ã«ã‚¢ã‚¯ã‚»ã‚¹
2. **ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ** ã‚’ç¢ºèª
3. **ãƒ–ãƒ©ã‚¦ã‚¶ã‚³ãƒ³ã‚½ãƒ¼ãƒ«** ã‚’é–‹ã (`F12 â†’ Console`)

#### **Step 2: åœ’å…é¸æŠç¢ºèª**
1. **ãƒãƒ£ãƒƒãƒˆ** ã‚¿ãƒ–ã‚’ã‚¯ãƒªãƒƒã‚¯
2. **åœ’å…ä¸€è¦§** ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã‹ã‚’ç¢ºèª
3. **åœ’å…ã‚’ã‚¯ãƒªãƒƒã‚¯** ã—ã¦ãƒãƒ£ãƒƒãƒˆã‚’é–‹ã
4. **ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°** ã§ã‚¨ãƒ©ãƒ¼ã‚’ç¢ºèª

#### **Step 3: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ãƒ†ã‚¹ãƒˆ**
1. **ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å…¥åŠ›æ¬„** ã«ãƒ†ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›
2. **é€ä¿¡ãƒœã‚¿ãƒ³** ã‚’ã‚¯ãƒªãƒƒã‚¯
3. **ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ã‚¨ãƒ©ãƒ¼ç¢ºèª**ï¼š
   - `ä¿è­·è€…æƒ…å ±å–å¾—ã‚¨ãƒ©ãƒ¼`
   - `ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ã‚¨ãƒ©ãƒ¼`
   - `ä¼šè©±ä½œæˆã‚¨ãƒ©ãƒ¼`

---

### **2. åˆ©ç”¨è€…å´ãƒã‚§ãƒƒã‚¯**

#### **Step 1: åˆ©ç”¨è€…ãƒ­ã‚°ã‚¤ãƒ³ç¢ºèª**
1. **åˆ©ç”¨è€…å´** (`http://localhost:5175`) ã«ã‚¢ã‚¯ã‚»ã‚¹
2. **ä¿è­·è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³** ã‚’ç¢ºèª
3. **ãƒ–ãƒ©ã‚¦ã‚¶ã‚³ãƒ³ã‚½ãƒ¼ãƒ«** ã‚’é–‹ã

#### **Step 2: ç›´æ¥ãƒãƒ£ãƒƒãƒˆé–‹å§‹**
1. **ãƒãƒ£ãƒƒãƒˆ** ã‚¿ãƒ–ã‚’ã‚¯ãƒªãƒƒã‚¯
2. **åœ’ã¨é€£çµ¡** ã‚¿ãƒ–ã‚’é¸æŠ
3. **ãƒãƒ£ãƒƒãƒˆã‚’é–‹å§‹** ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
4. **ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ã‚¨ãƒ©ãƒ¼ç¢ºèª**ï¼š
   - `ä¼šè©±ã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ`
   - `facility_childrenæƒ…å ±ã®å–å¾—ã‚¨ãƒ©ãƒ¼`

---

### **3. ã‚ˆãã‚ã‚‹ã‚¨ãƒ©ãƒ¼ã¨åŸå› **

#### **âŒ Error: ä¿è­·è€…æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ**
**åŸå› **: `facility_children`ãƒ†ãƒ¼ãƒ–ãƒ«ã«é–¢é€£ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒãªã„
**è§£æ±º**: ç®¡ç†è€…å´ã§åœ’å…ã‚’å†ç™»éŒ²ã™ã‚‹

#### **âŒ Error: facility_childrenæƒ…å ±ã®å–å¾—ã‚¨ãƒ©ãƒ¼**
**åŸå› **: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¨©é™ã¾ãŸã¯ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹é€ ã®å•é¡Œ
**è§£æ±º**: Supabaseã§ãƒ†ãƒ¼ãƒ–ãƒ«ç¢ºèªãƒ»æ¨©é™è¨­å®š

#### **âŒ Error: ãƒãƒ£ãƒƒãƒˆã®é–‹å§‹ã«å¤±æ•—ã—ã¾ã—ãŸ**
**åŸå› **: `direct_chat_conversations`ãƒ†ãƒ¼ãƒ–ãƒ«ã¸ã®æ›¸ãè¾¼ã¿æ¨©é™ãŒãªã„
**è§£æ±º**: Supabaseã®ãƒ†ãƒ¼ãƒ–ãƒ«æ¨©é™ç¢ºèª

#### **âŒ Error: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸ**
**åŸå› **: `direct_chat_messages`ãƒ†ãƒ¼ãƒ–ãƒ«ã¸ã®æ›¸ãè¾¼ã¿æ¨©é™ãŒãªã„
**è§£æ±º**: Supabaseã®ãƒ†ãƒ¼ãƒ–ãƒ«æ¨©é™ç¢ºèª

---

### **4. ç·Šæ€¥ä¿®æ­£æ‰‹é †**

ã‚‚ã—ãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½ãŒå…¨ãå‹•ä½œã—ãªã„å ´åˆã¯ã€ä»¥ä¸‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š

#### **Supabaseãƒ†ãƒ¼ãƒ–ãƒ«æ¨©é™ç¢ºèª**
1. Supabase Dashboard â†’ Authentication â†’ Policies
2. ä»¥ä¸‹ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã«å¯¾ã—ã¦é©åˆ‡ãªæ¨©é™ãŒã‚ã‚‹ã‹ç¢ºèªï¼š
   - `direct_chat_conversations`
   - `direct_chat_messages`
   - `facility_children`

#### **ç·Šæ€¥ãƒ‡ãƒãƒƒã‚°è¿½åŠ **
ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã‚’å¢—ã‚„ã—ã¦å•é¡Œã‚’ç‰¹å®šã™ã‚‹ãŸã‚ã«ã€ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã¾ã™ï¼š

```typescript
// ç®¡ç†è€…å´ sendMessage é–¢æ•°ã®å…ˆé ­ã«è¿½åŠ 
console.log('ğŸ”§ ãƒ‡ãƒãƒƒã‚°: sendMessageé–‹å§‹', { 
  newMessage: newMessage.trim(), 
  chatChild, 
  userId: user?.id 
});

// åˆ©ç”¨è€…å´ handleStartDirectChat é–¢æ•°ã®å…ˆé ­ã«è¿½åŠ 
console.log('ğŸ”§ ãƒ‡ãƒãƒƒã‚°: handleStartDirectChaté–‹å§‹', { 
  userId: user?.id, 
  activeChildId 
});
```

---

### **5. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç¢ºèªSQL**

Supabaseã§ä»¥ä¸‹ã®SQLã‚’å®Ÿè¡Œã—ã¦ã€ãƒ‡ãƒ¼ã‚¿ã®å­˜åœ¨ã‚’ç¢ºèªï¼š

```sql
-- 1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ç¢ºèª
SELECT id, username, user_type FROM users WHERE user_type IN ('parent', 'admin');

-- 2. åœ’å…ã¨ä¿è­·è€…ã®é–¢é€£ç¢ºèª
SELECT 
  fc.id,
  c.name as child_name,
  u.username as parent_username,
  f.name as facility_name
FROM facility_children fc
JOIN children c ON c.id = fc.child_id
JOIN users u ON u.id = fc.parent_user_id
JOIN facilities f ON f.id = fc.facility_id
WHERE fc.status = 'active';

-- 3. ãƒãƒ£ãƒƒãƒˆä¼šè©±ç¢ºèª
SELECT 
  dcc.id,
  c.name as child_name,
  u.username as parent_username,
  f.name as facility_name
FROM direct_chat_conversations dcc
JOIN children c ON c.id = dcc.child_id
JOIN users u ON u.id = dcc.parent_user_id
JOIN facilities f ON f.id = dcc.facility_id;

-- 4. ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç¢ºèª
SELECT 
  dcm.id,
  dcm.content,
  dcm.sender_type,
  dcm.created_at
FROM direct_chat_messages dcm
ORDER BY dcm.created_at DESC
LIMIT 10;
```

