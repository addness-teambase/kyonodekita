# 個別支援計画書機能 - 使い方ガイド

## 概要

個別支援計画書機能は、保護者が記録した成長記録・できた記録をもとに、AIが自動で個別支援計画書を生成する機能です。

## 主な機能

### 1. **AIによる自動生成**
- 保護者側から記録された成長記録とできた記録を分析
- Gemini APIを使って、5領域に基づいた個別支援計画書を自動生成
- 総合的な支援方針、長期目標、短期目標、具体的な支援活動を提案

### 2. **5領域に基づいた計画書**
以下の5領域に基づいて計画書を作成します：
- **健康・生活**: 食事、排泄、睡眠などの生活習慣
- **運動・感覚**: 粗大運動、微細運動、感覚統合
- **認知・行動**: 理解力、注意力、問題解決能力
- **言語・コミュニケーション**: 言葉の理解・表出、対人コミュニケーション
- **人間関係・社会性**: 友達関係、集団活動、社会的ルール

### 3. **編集・保存機能**
- AIが生成した計画書を確認・編集
- データベースに保存して、いつでも参照可能
- 計画期間の管理（開始日・終了日）

## 使い方

### ステップ1: 管理画面にアクセス
1. admin-appにログイン
2. 左側のサイドバーから「個別支援計画書」をクリック

### ステップ2: 児童を選択
1. 「新しい計画書を作成」セクションで児童を選択
2. 「AIで計画書を生成」ボタンをクリック

### ステップ3: AI生成と確認
1. AIが成長記録・できた記録を分析
2. 個別支援計画書が自動生成される
3. 生成された内容を確認
   - 総合的な支援方針
   - 支援アプローチ
   - 長期目標（3〜5個）
   - 短期目標（5〜10個）
   - 具体的な支援活動（5〜10個）

### ステップ4: 編集（オプション）
1. 「編集」ボタンをクリック
2. 必要に応じて内容を修正
3. セクションを展開/折りたたんで確認

### ステップ5: 保存
1. 「保存」ボタンをクリック
2. データベースに保存される
3. 一覧画面で確認可能

### ステップ6: 保存済み計画書の確認
1. 一覧画面で保存済みの計画書を確認
2. 各計画書をクリックして詳細表示
3. AI生成フラグやステータスを確認

## データベース構造

個別支援計画書は以下のテーブルに保存されます：

1. **individual_support_plans**: 計画書の基本情報
   - 児童ID
   - 計画期間
   - 支援方針・アプローチ
   - AIフラグ・モデル情報
   - ステータス

2. **long_term_goals**: 長期目標
   - 計画書ID
   - 目標内容
   - 5領域分類
   - 優先度

3. **short_term_goals**: 短期目標
   - 計画書ID
   - 長期目標ID（関連付け）
   - 目標内容
   - 達成基準

4. **support_activities**: 支援活動
   - 計画書ID
   - 短期目標ID（関連付け）
   - 活動名・内容
   - 頻度・時間

## Gemini API設定

### 環境変数
`.env.local` ファイルに以下を設定してください：

```bash
VITE_GOOGLE_AI_API_KEY=your_gemini_api_key_here
```

### APIキーの取得方法
1. [Google AI Studio](https://aistudio.google.com/app/apikey) にアクセス
2. Googleアカウントでログイン
3. 「Create API Key」をクリック
4. 生成されたAPIキーをコピー
5. `.env.local` に貼り付け

### 使用モデル
- **モデル名**: `gemini-2.5-flash-preview-05-20`
- **無料枠**: 1日あたり100リクエストまで無料
- **特徴**: 高速・高精度な日本語対応

## 注意事項

### データの取得について
- 個別支援計画書は、保護者が記録した**成長記録**と**できた記録**をもとに生成されます
- 記録が少ない場合は、一般的な内容になる可能性があります
- より正確な計画書を生成するには、日々の記録が重要です

### プライバシーとセキュリティ
- 成長記録のデータはGemini APIに送信されます
- Googleのプライバシーポリシーに従って処理されます
- APIキーは安全に管理してください（コードにハードコードしない）

### 編集と保存
- AI生成後、必ず内容を確認してください
- 児童の実際の状況に合わせて編集してください
- 保存後も編集機能は今後追加予定です

## トラブルシューティング

### エラー: "APIキーが設定されていません"
- `.env.local` ファイルを確認
- `VITE_GOOGLE_AI_API_KEY` が正しく設定されているか確認
- アプリを再起動（開発サーバーを再起動）

### エラー: "計画書の生成に失敗しました"
- APIキーが有効か確認
- 無料枠の上限に達していないか確認
- ネットワーク接続を確認

### 児童が表示されない
- 施設に児童が登録されているか確認
- `facility_children` テーブルのステータスが `active` か確認
- ログインユーザーの施設IDが正しいか確認

### 成長記録が取得できない
- 保護者が成長記録を入力しているか確認
- `growth_records` テーブルにデータがあるか確認
- `records` テーブル（できた記録）にデータがあるか確認

## 今後の拡張予定

1. **保存済み計画書の編集機能**
   - 既存の計画書を再編集
   - バージョン管理

2. **PDF出力機能**
   - 計画書をPDF形式で出力
   - 印刷・共有

3. **モニタリング機能**
   - 計画書の進捗管理
   - 達成率の記録

4. **保護者との共有機能**
   - 計画書を保護者アプリで閲覧
   - 承認フロー

5. **評価機能**
   - 中間評価・最終評価の記録
   - 達成度の可視化

## 関連ファイル

### 実装ファイル
- `admin-app/src/lib/gemini.ts`: Gemini API連携ライブラリ
- `admin-app/src/components/IndividualSupportPlan.tsx`: メインコンポーネント
- `admin-app/src/App.tsx`: ルーティング・メニュー統合

### データベーススキーマ
- `shared/individual_support_plan_schema.sql`: テーブル定義

## お問い合わせ

機能に関するご質問やバグ報告は、開発チームまでお問い合わせください。
