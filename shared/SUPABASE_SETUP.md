# 🚀 Supabaseデータベース設定手順

## ⚠️ 重要：この設定を完了しないと管理者側の子供登録でエラーが発生します

## 📋 手順

### 1. Supabase管理画面にアクセス
以下のURLにアクセスしてください：
```
https://supabase.com/dashboard/project/ognianlobgsqcjpacgqo/sql
```

### 2. master_database.sqlの内容をコピー
`shared/master_database.sql` ファイルの**全内容**をコピーしてください。

### 3. SQL Editorに貼り付け
- Supabase管理画面のSQL Editorに貼り付け
- **Run**ボタンをクリック

### 4. 実行完了確認
以下のテーブルが正しく作成されることを確認：
- ✅ `users`
- ✅ `facilities` 
- ✅ `children`
- ✅ `facility_children` ← **この関連付けテーブルが重要**

### 5. デフォルトデータ確認
以下のデフォルトデータが挿入されることを確認：
- ✅ デフォルト施設: `id = '00000000-0000-0000-0000-000000000001'`

## 🔧 エラーが解決される理由

**現在のエラー原因**:
- `facility_children`テーブルが存在しないか、制約が正しく設定されていない
- デフォルト施設データが挿入されていない
- UNIQUE制約`(child_id, facility_id)`による重複エラー

**修正内容**:
- ✅ デフォルト施設の自動作成
- ✅ 重複チェック機能追加
- ✅ 詳細なエラーログ出力
- ✅ トランザクション処理でデータ整合性保持

## ⚡ 設定完了後
この設定が完了すると：
- 管理者側で子供登録が正常動作
- 利用者側で管理者設定データの自動取得が可能
- 完全なデータ互換性が実現

## 🆘 トラブルシューティング
設定後もエラーが続く場合は、ブラウザの開発者コンソールで詳細なエラーログを確認してください。

